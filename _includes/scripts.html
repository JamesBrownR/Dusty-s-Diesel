<!---  javascript --->

<script>


     document.addEventListener('DOMContentLoaded', function () {
    // --- Header and Logo Size on Scroll ---
    const header = document.getElementById('header');
    const navContainer = document.getElementById('nav-container');
    const headerLogo = document.getElementById('header-logo');

    // Function to handle scroll
    function handleScroll() {
        const scrollPosition = window.scrollY;
        
        // If scrolled down more than 50px, add 'scrolled' class
        if (scrollPosition > 35) {
            header.classList.add('scrolled');
            navContainer.classList.add('scrolled');
            headerLogo.classList.add('scrolled');
        } else {
            // At top, remove 'scrolled' class to make header/logo grow
            header.classList.remove('scrolled');
            navContainer.classList.remove('scrolled');
            headerLogo.classList.remove('scrolled');
        }
    }

    // Listen for scroll events
    window.addEventListener('scroll', handleScroll);
    
    // Call once on load to set initial state
    handleScroll();

    // --- Animate on Scroll (IntersectionObserver) ---
    const scrollElements = document.querySelectorAll('.animate-on-scroll');
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting && window.matchMedia('(min-width: 768px)').matches) {
                entry.target.classList.add('is-visible');
                observer.unobserve(entry.target);
            }
        });
    }, {
        threshold: 0.1
    });

    scrollElements.forEach(el => {
        observer.observe(el);
    });
    
    // --- Mobile Menu Toggle ---
    const menuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const iconOpen = document.getElementById('menu-icon-open');
    const iconClose = document.getElementById('menu-icon-close');

    if (menuButton) {
        menuButton.addEventListener('click', () => {
            const isExpanded = menuButton.getAttribute('aria-expanded') === 'true';
            menuButton.setAttribute('aria-expanded', !isExpanded);
            mobileMenu.classList.toggle('hidden');
            iconOpen.classList.toggle('hidden');
            iconClose.classList.toggle('hidden');
        });
    }
    
    // --- Dynamic Gallery Population (HOME PAGE) ---
    const galleryContainer = document.getElementById('gallery-grid');
    const galleryImages = [
        { src: '{{ site.baseurl }}/Pics/Custom-Diesel-Engine-Build.webp', alt: 'Custom diesel engine build' },
        { src: '{{ site.baseurl }}/Pics/Car-Lift.webp', alt: 'Truck on a service lift' },
        { src: '{{ site.baseurl }}/Pics/Performance-Tuning-Setup.webp', alt: 'Performance tuning setup' },
        { src: '{{ site.baseurl }}/Pics/Finished-Custom-Truck-Project.webp', alt: 'Finished custom truck project' },
        { src: '{{ site.baseurl }}/Pics/Suspension-Upgrade.webp', alt: 'Suspension upgrade' },
        { src: '{{ site.baseurl }}/Pics/Custom-Fabrication-Work.webp', alt: 'Custom fabrication work' },
        { src: '{{ site.baseurl }}/Pics/Turbo-Installation.webp', alt: 'Turbo installation' },
        { src: '{{ site.baseurl }}/Pics/Oil-Change.webp', alt: 'Diesel oil change service' },
        // Add more images if you have them
        { src: '{{ site.baseurl }}/Pics/Custom-Diesel-Engine-Build.webp', alt: 'Custom diesel engine build' },
        { src: '{{ site.baseurl }}/Pics/Car-Lift.webp', alt: 'Truck on a service lift' },
        { src: '{{ site.baseurl }}/Pics/Performance-Tuning-Setup.webp', alt: 'Performance tuning setup' },
        { src: '{{ site.baseurl }}/Pics/Finished-Custom-Truck-Project.webp', alt: 'Finished custom truck project' },
    ];

    if (galleryContainer) {
        const initialGalleryCount = 8;
        let currentGalleryCount = initialGalleryCount;
        
        // Create lightbox modal once
        const lightbox = document.createElement('div');
        lightbox.className = 'lightbox';
        lightbox.innerHTML = `
            <span class="lightbox-close">&times;</span>
            <img src="" alt="">
        `;
        document.body.appendChild(lightbox);

        const lightboxImg = lightbox.querySelector('img');
        const lightboxClose = lightbox.querySelector('.lightbox-close');

        // Function to rendler gallery images
        function renderGalleryImages(count) {
            galleryContainer.innerHTML = '';
            const imagesToShow = galleryImages.slice(0, count);
            
            imagesToShow.forEach(image => {
                const card = document.createElement('div');
                card.className = 'gallery-card relative group';
                
                card.innerHTML = `
                    <div class="overflow-hidden">
                        <img src="${image.src}" alt="${image.alt}" class="w-full h-auto aspect-video object-cover transition-all duration-500 ease-in-out group-hover:scale-110 cursor-pointer">
                    </div>
                `;
                galleryContainer.appendChild(card);
            });
        }

        // Initial render
        renderGalleryImages(currentGalleryCount);

        // Show More button for gallery (only on home page)
        const showMoreGalleryBtn = document.getElementById('show-more-gallery');
        const showLessGalleryBtn = document.getElementById('show-less-gallery');
        
        if (showMoreGalleryBtn) {
            showMoreGalleryBtn.addEventListener('click', () => {
                currentGalleryCount = galleryImages.length;
                renderGalleryImages(currentGalleryCount);
                showMoreGalleryBtn.classList.add('hidden');
                if (showLessGalleryBtn) showLessGalleryBtn.classList.remove('hidden');
            });
        }
        
        if (showLessGalleryBtn) {
            showLessGalleryBtn.addEventListener('click', () => {
                currentGalleryCount = initialGalleryCount;
                renderGalleryImages(currentGalleryCount);
                showLessGalleryBtn.classList.add('hidden');
                if (showMoreGalleryBtn) showMoreGalleryBtn.classList.remove('hidden');
                // Scroll back to gallery section
                const gallerySection = document.getElementById('gallery');
                if (gallerySection) {
                    gallerySection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        }

        // Add click event to all gallery images
        galleryContainer.addEventListener('click', (e) => {
            if (e.target.tagName === 'IMG') {
                lightbox.classList.add('active');
                lightboxImg.src = e.target.src;
                lightboxImg.alt = e.target.alt;
                document.body.style.overflow = 'hidden';
            }
        });

        // Close lightbox
        lightboxClose.addEventListener('click', () => {
            lightbox.classList.remove('active');
            document.body.style.overflow = 'auto';
        });

        // Close on background click
        lightbox.addEventListener('click', (e) => {
            if (e.target === lightbox) {
                lightbox.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        });

        // Close on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && lightbox.classList.contains('active')) {
                lightbox.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        });
    }

    // --- Dynamic Gallery Population (REMOTE TUNING PAGE) ---
    const remoteGalleryContainer = document.getElementById('remote-gallery-grid');
    const remoteGalleryImages = [
        { src: '{{ site.baseurl }}/Pics/Custom-Diesel-Engine-Build.webp', alt: 'Remote tuning setup' },
        { src: '{{ site.baseurl }}/Pics/Car-Lift.webp', alt: 'Remote connection screen' },
        { src: '{{ site.baseurl }}/Pics/Performance-Tuning-Setup.webp', alt: 'ECU tuning remotely' },
        { src: '{{ site.baseurl }}/Pics/Finished-Custom-Truck-Project.webp', alt: 'Tuned truck results' },
        { src: '{{ site.baseurl }}/Pics/Suspension-Upgrade.webp', alt: 'Remote diagnostic' },
        { src: '{{ site.baseurl }}/Pics/Custom-Fabrication-Work.webp', alt: 'TeamViewer session' },
        { src: '{{ site.baseurl }}/Pics/Turbo-Installation.webp', alt: 'Remote tuning process' },
        { src: '{{ site.baseurl }}/Pics/Oil-Change.webp', alt: 'Customer satisfied' },
        { src: '{{ site.baseurl }}/Pics/dyno.webp', alt: 'Dyno results' },
        { src: '{{ site.baseurl }}/Pics/exhaustsystem.webp', alt: 'Exhaust work' },
    ];

    if (remoteGalleryContainer) {
        const initialRemoteGalleryCount = 8;
        let currentRemoteGalleryCount = initialRemoteGalleryCount;
        
        // Create lightbox modal for remote gallery
        const remoteLightbox = document.createElement('div');
        remoteLightbox.className = 'lightbox';
        remoteLightbox.innerHTML = `
            <span class="lightbox-close">&times;</span>
            <img src="" alt="">
        `;
        document.body.appendChild(remoteLightbox);

        const remoteLightboxImg = remoteLightbox.querySelector('img');
        const remoteLightboxClose = remoteLightbox.querySelector('.lightbox-close');

        // Function to render remote gallery images
        function renderRemoteGalleryImages(count) {
            remoteGalleryContainer.innerHTML = '';
            const imagesToShow = remoteGalleryImages.slice(0, count);
            
            imagesToShow.forEach(image => {
                const card = document.createElement('div');
                card.className = 'gallery-card relative group';
                
                card.innerHTML = `
                    <div class="overflow-hidden">
                        <img src="${image.src}" alt="${image.alt}" class="w-full h-auto aspect-video object-cover transition-all duration-500 ease-in-out group-hover:scale-110 cursor-pointer">
                    </div>
                `;
                remoteGalleryContainer.appendChild(card);
            });
        }

        // Initial render
        renderRemoteGalleryImages(currentRemoteGalleryCount);

        // Show More button for remote gallery
        const showMoreRemoteGalleryBtn = document.getElementById('show-more-remote-gallery');
        const showLessRemoteGalleryBtn = document.getElementById('show-less-remote-gallery');
        
        if (showMoreRemoteGalleryBtn) {
            showMoreRemoteGalleryBtn.addEventListener('click', () => {
                currentRemoteGalleryCount = remoteGalleryImages.length;
                renderRemoteGalleryImages(currentRemoteGalleryCount);
                showMoreRemoteGalleryBtn.classList.add('hidden');
                showLessRemoteGalleryBtn.classList.remove('hidden');
            });
        }
        
        if (showLessRemoteGalleryBtn) {
            showLessRemoteGalleryBtn.addEventListener('click', () => {
                currentRemoteGalleryCount = initialRemoteGalleryCount;
                renderRemoteGalleryImages(currentRemoteGalleryCount);
                showLessRemoteGalleryBtn.classList.add('hidden');
                showMoreRemoteGalleryBtn.classList.remove('hidden');
                // Scroll back to gallery section
                const remoteGallerySection = document.getElementById('remote-gallery');
                if (remoteGallerySection) {
                    remoteGallerySection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        }

        // Add click event to all remote gallery images
        remoteGalleryContainer.addEventListener('click', (e) => {
            if (e.target.tagName === 'IMG') {
                remoteLightbox.classList.add('active');
                remoteLightboxImg.src = e.target.src;
                remoteLightboxImg.alt = e.target.alt;
                document.body.style.overflow = 'hidden';
            }
        });

        // Close remote lightbox
        remoteLightboxClose.addEventListener('click', () => {
            remoteLightbox.classList.remove('active');
            document.body.style.overflow = 'auto';
        });

        // Close on background click
        remoteLightbox.addEventListener('click', (e) => {
            if (e.target === remoteLightbox) {
                remoteLightbox.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        });

        // Close on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && remoteLightbox.classList.contains('active')) {
                remoteLightbox.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        });
    }
                          
    // --- Dynamic Review Population (FIXED) ---
    const reviewsContainer = document.getElementById('reviews-container');
    const showMoreBtn = document.getElementById('show-more-reviews');
    const showLessBtn = document.getElementById('show-less-reviews');
    
    const reviews = [
    {
        "name": "Ramiro Parga",
        "rating": 5,
        "body": "Dusty, Brad and Miguel are very professional mechanics, who took us in when they had other's and treaded us like family right away and will definitely be coming back for more upgrades very much recommended thank you üôè y'all are BLESSINGS to us guys from San Antonio, TX very reasonable much appreciated guys."
    },
    {
        "name": "Juan Ledezma",
        "rating": 5,
        "body": "Great work awesome people appreciate their work and time to get us back on the road, definitely letting them do any work on my truck will be coming back"
    },
    {
        "name": "hector lazo",
        "rating": 5,
        "body": "My driver ran out of diesel. I called them and they went out of their way to help us out. We are a trucking company just passing through, but if we were from the area, they would be out go to guys. Thank you Brad & Dusty for helping us out. Best of luck to you guys!"
    },
    {
        "name": "Winona Parsons",
        "rating": 5,
        "body": "Well of course this is the best diesel shop ever!! The staff is very knowledgeable and courteous! Stop by and ask about the new Dynojet!!"
    },
    {
        "name": "Darrell Collins",
        "rating": 5,
        "body": "Brad and Miguel are very knowledgeable and professional. Their shop deleted the def and EGR systems in 2021. The truck has ran great since then. I had to get the transmission rebuilt in June 2023 and the shop that did the rebuild could not ‚Ä¶ More"
    },
    {
        "name": "Ashley Giles",
        "rating": 5,
        "body": "I was in town for a short period of time visiting family and my diesel truck was having issues. Rusty got me in the same day I called and the truck was fixed the very next day! He took the time to show me what he thought the issue was, what ‚Ä¶ More"
    },
    {
        "name": "Kyle Bebber",
        "rating": 5,
        "body": "Have had a few things done here on a couple vehicles. Very honest and knowledgeable. Would recommend to anyone who needs repairs or tuning."
    },
    {
        "name": "Daniel S.",
        "rating": 5,
        "body": "Dusty is fair priced and does high quality work!! This is the place to go when you want high performance install, at a affordable price. Dusty is the man !!!!"
    },
    {
        "name": "Betty Hopper",
        "rating": 5,
        "body": "Couldn't ask for more professional and helpful folks!! Outstanding service, above & beyond anything we expected! We would certainly highly recommend them!!"
    },
    {
        "name": "Walter Bannon",
        "rating": 5,
        "body": "Very knowledgeable shop! They will get you taken care of!"
    },
    {
        "name": "Bud Bell",
        "rating": 5,
        "body": "They took care everything That needed to be done on the truck. And it runs beautiful."
    },
    {
        "name": "Lee Cook",
        "rating": 5,
        "body": "Very knowledgeable, quick, and very affordable"
    },
    {
        "name": "Galdino Rios",
        "rating": 5,
        "body": "Exelente work"
    },
    {
        "name": "Misty Gregory",
        "rating": 5,
        "body": "Reasonable price‚Ä¶ More"
    },
    {
        "name": "Cody Wright",
        "rating": 5,
        "body": ""
    },
    {
        "name": "Daniel Orta",
        "rating": 5,
        "body": ""
    },
    {
        "name": "Kenny Rogers",
        "rating": 5,
        "body": ""
    },
    {
        "name": "LaWanda Beyer",
        "rating": 5,
        "body": ""
    },
    {
        "name": "Trevor Tate",
        "rating": 5,
        "body": ""
    },
    {
        "name": "Keith Lowe",
        "rating": 5,
        "body": ""
    },
    {
        "name": "Lindsey Bales",
        "rating": 5,
        "body": ""
    },
    {
        "name": "Danna",
        "rating": 4,
        "body": ""
    },
    {
        "name": "Bruce David",
        "rating": 4,
        "body": ""
    },
];
    
    const initialReviewCount = 6;
    
    // Helper function to render star icons
    function renderStars(rating) {
        let starsHTML = '';
        const fullStars = Math.floor(rating);
        const halfStar = rating % 1 !== 0;
        
        for(let i = 0; i < fullStars; i++) {
            starsHTML += '<i class="fa-solid fa-star text-yellow-400"></i>';
        }
        if (halfStar) {
            starsHTML += '<i class="fa-solid fa-star-half-stroke text-yellow-400"></i>';
        }
        const emptyStars = 5 - Math.ceil(rating);
        for(let i = 0; i < emptyStars; i++) {
            starsHTML += '<i class="fa-regular fa-star text-yellow-400"></i>';
        }
        return starsHTML;
    }
    
    // Function to render reviews
    function renderReviews(count) {
        if (!reviewsContainer) return;
        
        reviewsContainer.innerHTML = '';
        const reviewsToShow = reviews.slice(0, count);
        
        reviewsToShow.forEach(review => {
            const card = document.createElement('div');
            card.className = 'review-card p-8';
            
            card.innerHTML = `
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 rounded-full bg-brand-red flex items-center justify-center text-white text-xl font-bold">
                        ${review.name.charAt(0)}
                    </div>
                    <div class="ml-4">
                        <h4 class="text-lg font-bold text-white">${review.name}</h4>
                        <div class="flex items-center text-sm text-gray-400">
                            ${renderStars(review.rating)}
                            <span class="ml-2">${review.rating} Stars</span>
                        </div>
                    </div>
                </div>
                <p class="text-gray-300 italic">"${review.body}"</p>
            `;
            reviewsContainer.appendChild(card);
        });
    }

    // Initial render - show only 6 reviews
    renderReviews(initialReviewCount);
    
    // Show More button
    if (showMoreBtn) {
        showMoreBtn.addEventListener('click', () => {
            renderReviews(reviews.length);
            showMoreBtn.classList.add('hidden');
            showLessBtn.classList.remove('hidden');
        });
    }
    
    // Show Less button
    if (showLessBtn) {
        showLessBtn.addEventListener('click', () => {
            renderReviews(initialReviewCount);
            showLessBtn.classList.add('hidden');
            showMoreBtn.classList.remove('hidden');
            // Scroll back to reviews section
            const reviewsSection = document.getElementById('reviews');
            if (reviewsSection) {
                reviewsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    }
});
</script>
